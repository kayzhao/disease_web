#parse("/WEB-INF/views/container/header.html")

<body>
    <div class="container">
        #parse("/WEB-INF/views/container/menu.html")
        <div class="tab-content">
            <div class="tab-pane active fade in" id="index">
                <h2>
                            <strong class="text-uppercase"><span
                                class="glyphicon glyphicon-info-sign"> </span>LDAP</strong>
                        </h2>
                <hr class="G-MarginTop20">
                <div class="row">
                    <p class="text-default alert alert-info G-MarginTop20 ldap-brief">
                        Long noncoding RNAs are a biggest class of non-coding RNA with greater than 200nt in length which can regulate gene expression in different levels including transcriptional, pos-transcriptional and epigenetic regulation. Identifing lncRNA-disease association would contribute to dissect the complex mechanisms of disease pathogenesis. Here, we developed a new lncRNA-disease association predictor, LDAP (lncRNA-disease association predictor), by integrating multiple biological data resources. The LDAP provides two ways to input your data: a lncRNA sequence or a txt file with multiple sequences with FASTA format.
                    </p>
                </div>
                <div class="row">
                    <form id="ldap-calculate" class="form-horizontal" action="${BAST_PATH}/index/submit" method="post" enctype="multipart/form-data">
                        <div class="col-xs-2 "></div>
                        <div class="col-xs-8 ">
                            <div class="row">
                                <span class="text-info">Please input the
                                    LncSeq(length≥200 , one sequence, <a href="http://en.wikipedia.org/wiki/Fasta_format" target="__blank">FASTA Format</a>):</span><a class="btn btn-link" id="example" style="margin-left: 10%">load example</a>
                            </div>
                            <textarea style="height: 300px;" type="text" placeholder="Please input the LncSeqs you want to search in fasta format" class="form-control" id="sequence" name="sequence"></textarea>
                            <hr class="row ">
                            <!-- file -->
                            <div class="row form-group G-MarginTop20">
                                <div class="col-xs-5 text-info">
                                    Or upload the file from your local computer<span class="text-danger">(only *.txt is allowed,size less
                                        than 500000B)</span>:
                                </div>
                                <div class="col-xs-7">
                                    <input type="file" id="inputfile" name="file">
                                </div>
                            </div>
                            <hr class="row ">
                            <!-- email -->
                            <div class="row form-group G-MarginTop20" id="email_div" style="display: none;">
                                <div class="col-xs-9 text-info">
                                    Email: (mandatory, where results will be sent to.) <span class="text-default"><input type="text" id="email" name="email"></span>
                                </div>
                            </div>
                            <div>
                                <p class="text-danger pull-left" style="display: none;" id="info"></p>
                                <button type="submit" class="btn btn-info btn-small pull-right" id="submitbtn">Submit</button>
                            </div>
                        </div>
                        <div class="col-xs-2"></div>
                    </form>
                </div>
            </div>
            <div class="tab-pane" id="readme">
                <h2> <strong class="text-uppercase"><span
                                class="glyphicon glyphicon-info-sign"> </span>Read Me</strong>
                        </h2>
                <hr class="G-MarginTop20"> #include("/WEB-INF/views/container/readme.html")
            </div>
            <div class="tab-pane" id="about">
                <h2>
                        <strong class="text-uppercase"><span
                            class="glyphicon glyphicon-info-sign"> </span>About</strong>
                    </h2>
                <hr class="G-MarginTop20">
                <p class="text-default alert alert-info G-MarginTop20 ldap-brief">LDAP is a non-profit tool used to provide predict severs for lncRNA-disease association.</p>
                <p class="text-default alert alert-info G-MarginTop20 ldap-brief">Questions and comments on the tool and suggestions for improvement to the website are always welcome.</p>
                <h3>
                        <strong><span class="glyphicon  glyphicon-envelope"></span>
                            Please contact:</strong>
                    </h3>
                <p>
                    Wei Lan: <a href="mailto:weilan@csu.edu.cn">weilan@csu.edu.cn</a>
                    <p>
                        Kaijie Zhao:<a href="mailto:kay.zkj@csu.edu.cn">kay.zkj@csu.edu.cn</a>
                        <p>
                            Jianxin Wang:<a href="mailto:jxwang@mail.csu.edu.cn">
                            jxwang@mail.csu.edu.cn</a>
                            <p>
                                Min Li: <a href="mailto:limin@mail.csu.edu.cn">limin@mail.csu.edu.cn</a>
            </div>
            <div class="tab-pane" id="result">
                <h2>
                        <strong class="text-uppercase"><span
                            class="glyphicon glyphicon-info-sign"> </span>Result</strong>
                    </h2>
                <hr class="G-MarginTop20">
                <p class="text-default alert alert-info G-MarginTop20 ldap-brief">You can check out the result for your submit by the email and jobid</p>
                <!-- <div class="row">
                   <div class="col-xs-1"></div> -->
                <form class="form-horizontal col-xs-10" action="${BAST_PATH}/checkresult" method="post" id="check-result">
                    <div class="row form-group G-MarginTop20">
                        Email:
                        <input type="text" id="check_email" name="check_email" placeholder="input your email" data-bv-notempty data-bv-emailAddress data-bv-message="please input the right email">
                    </div>
                    <div class="row form-group G-MarginTop20">
                        Jobid:
                        <input type="text" id="check_jobid" name="check_jobid" placeholder="input your jobid" data-bv-notempty data-bv-numeric data-bv-message="please input the right jobid">
                    </div>
                    <button type="submit" class="btn btn-info btn-small" id="result-go">GO</button>
                </form>
            </div>
        </div>
        #include("/WEB-INF/views/container/footer.html")
    </div>
    <script type="text/javascript">
    jQuery.noConflict();
    (function($) {

        //文件校验
        function file_format_check(url, type) {
            $("#ldap-calculate").ajaxSubmit({
                type: type,
                url: url,
                success: function(data) {
                    console.log(data);
                    if (data > 0) {
                        $("#email_div").css({
                            "display": "block"
                        });
                        $("#sequence").prop("disabled", true);
                    } else {
                        console.log("no data");
                        //状态还原
                        $("#email_div").css({
                            "display": "none"
                        });
                        $("#sequence").prop("disabled", false);

                        //消息提示
                        alert_info("The file'format is not valid");

                        //清空文件选择
                        /* $('#myModal').on('hidden.bs.modal', function(e) {
                             if ($("#email_div").css("display") == "none") {
                                 var fileBox = $("#inputfile");
                                 fileBox.after(fileBox.clone().val(""));
                                 fileBox.remove();
                             }
                         });*/
                    }
                },
                error: function(XmlHttpRequest, textStatus, errorThrown) {
                    console.log(XmlHttpRequest);
                    console.log(textStatus);
                    console.log(errorThrown);

                    $("#email_div").css({
                        "display": "none"
                    });
                    $("#sequence").prop("disabled", false);
                    file.value = "";
                    alert_info("server error");
                    //alert("server error");
                }
            });
        }


        //显示提示消息
        //info表示要提示的信息
        function alert_info(info) {
            $('#myModal').modal('show');
            $('#info-body').html(info);
        }

        //去除空格
        //自定义trim，防止trim失效
        function trimStr(str) {
            return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g, "");
        }

        $(function() {
            //提交计算校验
            $("#submitbtn").on(
                "click",
                function() {
                    var emailAddress = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/;
                    var sequence = trimStr($("#sequence").val());
                    var email = trimStr($("#email").val());

                    //alert(sequence + email);
                    if ($('input[name="file"]').prop('files').length <= 0 && sequence.length <= 0) {
                        alert_info("Please input a sequence or a file...");
                        return false;
                    } else {
                        if ($("#email_div").css("display") == "block" && $('input[name="file"]').prop('files').length > 0) {
                            if (emailAddress.test(email)) {
                                $("#ldap-calculate").submit();
                                // return true;
                            } else {
                                alert_info("The email is not valid");
                                //alert("The email is not valid");
                                $("#email_div").focus();
                                return false;
                            }
                        } else if (sequence.length >= 200) {
                            var sequence_pattern = new RegExp("^[agctAGCT]*$");
                            var arr = sequence.split(/\r\n|\r|\n/);
                            console.log(arr);
                            if (arr.length == 2) {
                                var LncSeq = trimStr(arr[1]);
                                // console.log(trimStr(arr[1])));
                                console.log(sequence_pattern.test(LncSeq));
                                if (sequence_pattern.test(LncSeq)) {
                                    // return false;
                                    $("#ldap-calculate").submit();
                                } else {
                                    alert_info("The sequence has invalid characters");
                                    return false;
                                }
                            } else {
                                alert_info("The sequence is not valid");
                                return false;
                            }
                        } else {
                            alert_info("The sequence or the file is not valid");
                            //alert("The sequence or the email is not valid");
                            return false;
                        }
                    }
                });


            //如果有file，则要求提交email
            $('input[name="file"]').change(function() {
                var files = $(this).prop('files');
                console.log(files.length);
                if (files.length > 0) {
                    $("#email_div").css({
                        "display": "block"
                    });
                    //$("#sequence").val("");
                    $("#sequence").prop("disabled", true);
                    //校验格式
                    file_format_check("index/validateFasta", "POST");
                } else {
                    $("#email_div").css({
                        "display": "none"
                    });
                    $("#sequence").prop("disabled", false);
                }
            });

            //查看提交结果
            $("#check-result").on(
                "click",
                function() {
                    $("#check-result").bootstrapValidator();
                    var isValid = $('#check-result').data(
                        'bootstrapValidator').isValid();
                    if (isValid) {
                        $("#check-result").submit();
                    }
                });

            $("#example")
                .click(
                    function() {
                        var example = ">7SK\nGGATGTGAGGGCGATCTGGCTGCGACATCTGTCACCCCATTGATCGCCAGGGTTGATTCGGCTGATCTGGCTGGCTAGGCGGGTGTCCCCTTCCTCCCTCACCGCTCCATGTGCGTCCCTCCCGAAGCTGCGCGCTCGGTCGAAGAGGACGACCATCCCCGATAGAGGAGGACCGGTCTTCGGTCAAGGGTATACGAGTAGCTGCGCTCCCCTGCTAGAACCTCCAAACAAGCTCTCAAGGTCCATTTGTAGGAGAACGTAGGGTAGTCAAGCTTCCAAGACTCCAGACACATCCAAATGAGGCGCTGCATGTGGCAGTCTGCCTTTCTTTT";
                        $("#sequence").val(example);
                        $("#sequence")[0].focus();
                    });
        })
    })(jQuery)
    </script>
</body>

</html>
